# This Python file uses the following encoding: utf-8
import random
import numpy
import math
import time
from matplotlib import pyplot as plt

past = time.time()
dic_index_name = {32: '沈阳市', 31: '长春市', 30: '哈尔滨市', 29: '北京市', 28: '天津市', 27: '呼和浩特市',
                  26: '银川市', 25: '太原市', 24: '石家庄市', 23: '济南市', 22: '郑州市', 21: '西安市', 20: '武汉市',
                  19: '南京市', 18: '合肥市', 17: '上海市', 16: '长沙市', 15: '南昌市', 14: '杭州市', 13: '福州市',
                  12: '广州市', 11: '台北市', 10: '海口市', 9: '南宁市', 8: '重庆市', 7: '昆明市', 6: '贵阳市',
                  5: '成都市', 4: '兰州市', 3: '西宁市', 2: '拉萨市', 1: '乌鲁木齐市'}
dic_index_place = {32: [2.154244048146993, 0.7294912182922052], 31: [2.187325175868926, 0.7659698737492407],
                   30: [2.210327969638388, 0.7986097124230996], 29: [2.0316555597855377, 0.6964734111155344],
                   28: [2.045354596724563, 0.6828704545518307], 27: [1.9504401711557782, 0.712818471920339],
                   26: [1.8541065485590256, 0.6717150953712464], 25: [1.9643549482436429, 0.6607295392735886],
                   24: [1.9984449984462764, 0.6640188042351897], 23: [2.0420513342223616, 0.6401136054292765],
                   22: [1.9838357024891653, 0.606641139982461], 21: [1.901501679981925, 0.5980049715909127],
                   20: [1.9948863593679227, 0.5337976768954978], 19: [2.072882348566038, 0.559230475129219],
                   18: [2.046975257108088, 0.5560826865567846], 17: [2.120097536543057, 0.5450961181681606],
                   16: [1.9719127300502612, 0.4920797001036081], 15: [2.022699612168439, 0.5004992207751062],
                   14: [2.097075579058408, 0.5286158641594968], 13: [2.0822866363613897, 0.45509987335186247],
                   12: [1.9771201467663895, 0.4036104787564647], 11: [2.120925433473741, 0.4368685479579651],
                   10: [1.923350915835574, 0.34983763499409776], 9: [1.8905407679333055, 0.3983542975410362],
                   8: [1.8588622042515675, 0.515450793251826], 7: [1.7926669446315457, 0.4370410737545248],
                   6: [1.8625015473545334, 0.4638795776210947], 5: [1.816289714257901, 0.5351085587900857],
                   4: [1.8122481425755206, 0.6293898138128328], 3: [1.776358064502135, 0.6390922736575944],
                   2: [1.5902480213083736, 0.517388021455077], 1: [1.5292030363247693, 0.7649189935533225]}
message = {
    32: {31: 279.0319874669409, 30: 510.1784912846261, 29: 626.7724254736534, 28: 605.3338932439926,
                27: 980.0250980531824, 26: 1504.3253299386195, 25: 1026.0030741332728, 24: 867.2561962921199,
                23: 793.6056681803564, 22: 1155.5257572823552, 21: 1516.5410384037225, 20: 1489.635046431576,
                19: 1160.5199158598514, 18: 1231.7418765940142, 17: 1187.43767913049, 16: 1783.532924263976,
                15: 1609.5982696447297, 14: 1312.7280395316734, 13: 1788.1588941618284, 12: 2279.6794949417554,
                11: 1872.2675483539772, 10: 2720.0666922831433, 9: 2533.9153509376815, 8: 2041.376175711676,
                7: 2663.228543574813, 6: 2277.561010387585, 5: 2124.6000677101038, 4: 1805.672015178943,
                3: 1945.9794965730002, 2: 3189.5267556541853, 1: 2906.650951781033},
           31: {32: 279.03198746695705, 30: 232.43680020604515, 29: 859.9737604736805, 28: 858.8688239266372,
                27: 1163.6331247452633, 26: 1701.6653044942534, 25: 1263.8819558498285, 24: 1115.2369397691402,
                23: 1067.0852672825522, 22: 1423.9967994490562, 21: 1767.2441971505611, 20: 1768.3124378019695,
                19: 1435.6743306734584, 18: 1509.99385581572, 17: 1446.8852970668916, 16: 2062.361185362273,
                15: 1887.5011402082594, 14: 1579.0982779193141, 13: 2053.2415478869266, 12: 2557.591330587961,
                11: 2124.555805427558, 10: 2998.9853592506847, 9: 2811.846204890633, 8: 2304.6820871397754,
                7: 2928.1708300788077, 6: 2548.8121041006766, 5: 2375.2360514672664, 4: 2019.1060281475975,
                3: 2145.829660354567, 2: 3400.2078666151956, 1: 2996.206963558929},
           30: {32: 510.1784912846172, 31: 232.43680020604515, 29: 1056.8546443645162, 28: 1068.643544557975,
                27: 1320.286886488211, 26: 1859.9474237333784, 25: 1457.746535749892, 24: 1318.0714297426125,
                23: 1290.0892469395685, 22: 1641.2465810526396, 21: 1967.7315459528995, 20: 1997.0746551438658,
                19: 1668.1054884730195, 18: 1741.8627014877363, 17: 1675.4118214602893, 16: 2291.4719284058647,
                15: 2119.5717905768033, 14: 1809.7469653978396, 13: 2283.20825699266, 12: 2789.6706695016246,
                11: 2349.314735406246, 10: 3229.9784144917176, 9: 3038.727196904544, 8: 2514.966024981312,
                7: 3139.215490865927, 6: 2766.973818585707, 5: 2573.570003838408, 4: 2187.474163248299,
                3: 2302.2782618816605, 2: 3560.325892861812, 1: 3055.909393366116},
           29: {32: 626.7724254736534, 31: 859.9737604736805, 30: 1056.8546443645162, 28: 109.7270315699451,
                27: 407.5954717705973, 26: 890.061898158683, 25: 403.9349644685835, 24: 264.1590752564332,
                23: 362.7519704808248, 22: 621.2906275856606, 21: 910.878878083883, 20: 1053.6553945789055,
                19: 899.5974503471949, 18: 897.7625714605401, 17: 1067.128514261311, 16: 1339.3151960380771,
                15: 1249.238244278017, 14: 1121.9903754379923, 13: 1560.905727323641, 12: 1888.5411235248384,
                11: 1721.024245946348, 10: 2285.9244081601987, 9: 2045.9385163708328, 8: 1463.5785665061499,
                7: 2087.507487033359, 6: 1731.5787539294984, 5: 1517.3247643774748, 4: 1180.2467539981617,
                3: 1326.4401420513748, 2: 2563.6069250619275, 1: 2410.3925182311013},
           28: {32: 605.3338932439926, 31: 858.8688239266372, 30: 1068.643544557975, 29: 109.7270315699451,
                27: 500.8907581482011, 26: 951.421852503791, 25: 427.70554138342897, 24: 262.62095003418034,
                23: 272.86653303182726, 22: 577.7081711879086, 21: 911.5421765409394, 20: 985.3941212821874,
                19: 800.3521686331585, 18: 807.6816709040125, 17: 959.7095072575969, 16: 1275.7642006762046,
                15: 1167.8232192003557, 14: 1019.069329442037, 13: 1464.242548332954, 12: 1816.8580069955324,
                11: 1618.6747779326954, 10: 2224.5650137664734, 9: 1997.2830599795511, 8: 1446.8802392893572,
                7: 2070.9398729757913, 6: 1701.169573116353, 5: 1519.8223777569094, 4: 1223.5622676375867,
                3: 1379.2640030711702, 2: 2602.2338614754162, 1: 2504.0584768172475},
           27: {32: 980.0250980531824, 31: 1163.6331247452633, 30: 1320.286886488211, 29: 407.59547177060836,
                28: 500.8907581482011, 26: 539.9397785638505, 25: 338.8073476530424, 24: 390.3304639030016,
                23: 649.0311960755001, 22: 696.8697969727925, 21: 771.8680822371864, 20: 1163.1459544200598,
                19: 1161.314995415132, 18: 1113.873313626268, 17: 1378.371124604275, 16: 1410.5708330656857,
                15: 1403.8698543751939, 14: 1396.2957987485938, 13: 1783.119157532436, 12: 1974.8314372617094,
                11: 1976.8771625625996, 10: 2316.8613870905483, 9: 2028.7328387591085, 8: 1343.887913038895,
                7: 1945.9503738265653, 6: 1651.9809737861408, 5: 1326.2468298776148, 4: 869.8190031779546,
                3: 983.4442163258933, 2: 2240.64048916176, 1: 2003.7448879787976},
           26: {32: 1504.3253299386195, 31: 1701.6653044942534, 30: 1859.9474237333784, 29: 890.061898158683,
                28: 951.421852503791, 27: 539.9397785638505, 25: 556.410826273637, 24: 723.307662308965,
                23: 969.2798217027714, 22: 781.7152410196495, 21: 528.6551440987139, 20: 1146.8065851838164,
                19: 1342.7700592127733, 18: 1243.8720063488952, 17: 1604.2014112488296, 16: 1303.7752938809965,
                15: 1408.8504202043905, 14: 1566.19583529069, 13: 1843.6772902476314, 12: 1834.0858879944626,
                11: 2074.185557271085, 10: 2085.5518149367954, 9: 1752.5702842600822, 8: 995.718778931245,
                7: 1531.0998053400472, 6: 1324.6735504339792, 5: 892.4198935661087, 4: 343.05821868731704,
                3: 444.16707271465305, 2: 1700.7007911789503, 1: 1663.002214757609},
           25: {32: 1026.0030741332728, 31: 1263.8819558498285, 30: 1457.746535749892, 29: 403.9349644685835,
                28: 427.70554138341834, 27: 338.80734765306903, 26: 556.410826273637, 24: 172.50691273447262,
                23: 415.1393703753569, 22: 358.7526235097547, 21: 514.1027868967274, 20: 824.3425917690818,
                19: 859.2615936827349, 18: 793.9778867583049, 17: 1099.1251169815066, 16: 1075.0534317769036,
                15: 1066.6982393530632, 14: 1093.949571056608, 13: 1455.5606343900474, 12: 1639.329661091663,
                11: 1658.5065673335655, 10: 1993.3228195181573, 9: 1719.3240229520445, 8: 1080.5677410732005,
                7: 1700.738482184802, 6: 1368.006210632059, 5: 1116.131961720565, 4: 799.2083523194079,
                3: 962.7578087084948, 2: 2174.8025809548944, 1: 2189.7689448820374},
           24: {32: 867.256196292125, 31: 1115.2369397691402, 30: 1318.0714297426125, 29: 264.1590752564332,
                28: 262.62095003418034, 27: 390.3304639030016, 26: 723.3076623089524, 25: 172.50691273452486,
                23: 268.1857546007937, 22: 373.08639216825367, 21: 652.0262332758763, 20: 829.7191404765257,
                19: 771.9448296240746, 18: 732.6460712660422, 17: 989.4620632549629, 16: 1104.310206740414,
                15: 1049.541890501333, 14: 1006.5372348719574, 13: 1405.086983697879, 12: 1662.8700945204562,
                11: 1591.104552784647, 10: 2043.8737727156426, 9: 1791.851759732911, 8: 1199.6064952789477,
                7: 1823.6771295140293, 6: 1468.6001409809617, 5: 1260.1974484981351, 4: 971.3279456869814,
                3: 1135.1092856159419, 2: 2344.4293520446595, 1: 2336.0943658146884},
           23: {32: 793.6056681803564, 31: 1067.0852672825522, 30: 1290.0892469395685, 29: 362.7519704808248,
                28: 272.86653303182726, 27: 649.0311960755071, 26: 969.2798217027714, 25: 415.139370375346,
                24: 268.1857546007937, 22: 368.89547191506534, 21: 776.6098335533715, 20: 721.8595058692247,
                19: 540.099443983739, 18: 535.9033007812786, 17: 732.1698605930161, 16: 1015.2857701898255,
                15: 895.3542627679032, 14: 767.9156975894984, 13: 1198.5582987507646, 12: 1548.2157352888278,
                11: 1364.1337588223212, 10: 1963.610660031854, 9: 1751.172234304343, 8: 1257.9664914676182,
                7: 1875.4143835574823, 6: 1484.1514514155244, 5: 1369.3025306204277, 4: 1179.766362826474,
                3: 1356.5075584917502, 2: 2523.7438267351436, 1: 2601.0891350050033},
           22: {32: 1155.5257572823552, 31: 1423.9967994490562, 30: 1641.2465810526396, 29: 621.2906275856606,
                28: 577.7081711879086, 27: 696.8697969727925, 26: 781.7152410196495, 25: 358.7526235097547,
                24: 373.08639216825367, 23: 368.89547191506534, 21: 435.61793863459565, 20: 467.77735009208357,
                19: 561.5292774865649, 18: 465.4391972748924, 17: 826.4720341022596, 16: 732.6187758443581,
                15: 708.0967647640274, 14: 785.1281153102988, 13: 1105.9485627472452, 12: 1293.8434259067405,
                11: 1318.985697709084, 10: 1670.8681439991801, 9: 1424.6764454133015, 8: 889.3256707414233,
                7: 1508.4482642593791, 6: 1125.7276246078977, 5: 1006.3617976467431, 4: 902.1365066371866,
                3: 1092.4017257506594, 2: 2191.0800334637347, 1: 2444.0293545841682},
           21: {32: 1516.5410384037225, 31: 1767.2441971505611, 30: 1967.7315459528995, 29: 910.8788780838731,
                28: 911.5421765409443, 27: 771.8680822371864, 26: 528.6551440987139, 25: 514.1027868967274,
                24: 652.0262332758625, 23: 776.6098335533715, 22: 435.61793863459565, 20: 647.4308525914963,
                19: 946.3237912977148, 18: 820.9347427597903, 17: 1217.7211780039488, 16: 775.9312571709613,
                15: 904.7079477901829, 14: 1141.430120498572, 13: 1347.519802971308, 12: 1307.9818749833223,
                11: 1587.9037233193073, 10: 1585.6246798275317, 9: 1273.2436567155328, 8: 574.148647839936,
                7: 1188.5627638069307, 6: 880.7472590292626, 5: 608.346582401853, 4: 505.88074241866406,
                3: 699.980672796228, 2: 1756.1188750144047, 1: 2117.5050356787933},
           20: {32: 1489.635046431576, 31: 1768.3124378019695, 30: 1997.0746551438658, 29: 1053.6553945789055,
                28: 985.3941212821966, 27: 1163.1459544200598, 26: 1146.8065851838164, 25: 824.3425917690872,
                24: 829.7191404765257, 23: 721.8595058692122, 22: 467.77735009208357, 21: 647.4308525914963,
                19: 454.28256814954096, 18: 317.2566293492399, 17: 687.980276175388, 16: 294.74278283588535,
                15: 262.11287711510863, 14: 562.1486348233718, 13: 700.8553623801231, 12: 835.4008134871534,
                11: 940.5730767955982, 10: 1241.790035337617, 9: 1046.8748549372026, 8: 758.8310928992361,
                7: 1294.2657575770593, 6: 863.7914090334709, 5: 978.707934233689, 4: 1146.023445054975,
                3: 1337.7718181516789, 2: 2228.1744387895274, 1: 2764.8195044159847},
           19: {32: 1160.5199158598514, 31: 1435.6743306734616, 30: 1668.1054884730195, 29: 899.597450347185,
                28: 800.3521686331585, 27: 1161.314995415132, 26: 1342.7700592127733, 25: 859.2615936827349,
                24: 771.9448296240746, 23: 540.099443983739, 22: 561.5292774865649, 21: 946.3237912977148,
                20: 454.28256814954096, 18: 141.45316834789205, 17: 271.4224983090961, 16: 701.5623925989865,
                15: 464.7560544054511, 14: 235.4094258970744, 13: 665.3720804591646, 12: 1128.6616534455904,
                11: 824.4060844875656, 10: 1583.236813819256, 9: 1451.9518107044444, 8: 1203.1662748996193,
                7: 1747.8942360176768, 6: 1315.7672515899906, 5: 1403.1852774846695, 4: 1444.5427667212657,
                3: 1638.0115805011026, 2: 2645.804303751732, 1: 3005.4760711021336},
           18: {32: 1231.7418765940217, 31: 1509.993855815717, 30: 1741.8627014877363, 29: 897.7625714605401,
                28: 807.6816709040125, 27: 1113.873313626268, 26: 1243.8720063488952, 25: 793.9778867583049,
                24: 732.6460712660546, 23: 535.9033007812786, 22: 465.4391972748924, 21: 820.9347427597903,
                20: 317.2566293492399, 19: 141.45316834795574, 17: 403.04693629220463, 16: 580.9087460807973,
                15: 378.4051519506648, 14: 324.521509471354, 13: 672.6417420703698, 12: 1048.1260998705902,
                11: 864.77301329695, 10: 1491.3815868965892, 9: 1337.8017732687565, 8: 1061.8581503224852,
                7: 1611.404634162588, 6: 1180.930955637762, 5: 1262.415746622248, 4: 1323.7048924586343,
                3: 1517.8049336439049, 2: 2506.306581312458, 1: 2902.7472791688883},
           17: {32: 1187.4376791304862, 31: 1446.8852970668916, 30: 1675.4118214602893, 29: 1067.128514261311,
                28: 959.7095072575969, 27: 1378.371124604275, 26: 1604.2014112488296, 25: 1099.1251169815066,
                24: 989.4620632549629, 23: 732.1698605930223, 22: 826.4720341022596, 21: 1217.7211780039488,
                20: 687.980276175388, 19: 271.4224983090629, 18: 403.04693629220463, 16: 886.3157385575776,
                15: 607.8751578084468, 14: 164.01394525625508, 13: 610.9498933507949, 12: 1210.9969238542194,
                11: 689.4252803653394, 10: 1678.1010691120912, 9: 1601.0851504530992, 8: 1446.7615146471917,
                7: 1960.5480248241317, 6: 1525.201226064549, 5: 1659.2907540415563, 4: 1715.5521168633277,
                3: 1908.8377118209544, 2: 2906.2342829396434, 1: 3266.9981768288344},
           16: {32: 1783.5329242639707, 31: 2062.361185362273, 30: 2291.4719284058647, 29: 1339.3151960380771,
                28: 1275.7642006762046, 27: 1410.5708330656857, 26: 1303.7752938809965, 25: 1075.0534317769036,
                24: 1104.310206740414, 23: 1015.2857701898255, 22: 732.6187758443518, 21: 775.9312571709613,
                20: 294.74278283588535, 19: 701.5623925989865, 18: 580.9087460807973, 17: 886.3157385575776,
                15: 289.4854658811258, 14: 733.4157976739847, 13: 668.4497672976307, 12: 564.3407026164648,
                11: 918.3167292575657, 10: 948.9353276659574, 9: 758.2875667115228, 8: 647.9009018610925,
                7: 1078.8419200293538, 6: 644.2857483913973, 5: 905.5594391165783, 4: 1226.3395439801252,
                3: 1406.2803796662868, 2: 2130.985343552937, 1: 2847.936240285011},
           15: {32: 1609.5982696447325, 31: 1887.5011402082594, 30: 2119.5717905768056, 29: 1249.238244278017,
                28: 1167.8232192003557, 27: 1403.8698543751939, 26: 1408.8504202043905, 25: 1066.6982393530632,
                24: 1049.5418905013244, 23: 895.3542627679032, 22: 708.0967647640274, 21: 904.7079477901829,
                20: 262.11287711510863, 19: 464.7560544054511, 18: 378.4051519506648, 17: 607.8751578084393,
                16: 289.4854658811258, 14: 449.5911428583783, 13: 444.0730129173321, 12: 670.0990016698115,
                11: 689.6873548847279, 10: 1119.084413773094, 9: 998.6502122946195, 8: 916.5682289798547,
                7: 1367.3734962312833, 6: 933.4270963049196, 5: 1162.944342442034, 4: 1396.7325485051026,
                3: 1586.303327215636, 2: 2403.4243691571755, 1: 3019.7650974732874},
           14: {32: 1312.7280395316734, 31: 1579.0982779193141, 30: 1809.7469653978396, 29: 1121.9903754379923,
                28: 1019.069329442037, 27: 1396.2957987485906, 26: 1566.19583529069, 25: 1093.9495710566123,
                24: 1006.5372348719574, 23: 767.9156975894984, 22: 785.1281153102988, 21: 1141.430120498572,
                20: 562.1486348233718, 19: 235.4094258970744, 18: 324.521509471354, 17: 164.01394525631002,
                16: 733.4157976739847, 15: 449.5911428583783, 13: 475.5959164025019, 12: 1048.2519599327907,
                11: 599.7021053499001, 10: 1514.9824560005632, 9: 1438.4080009742459, 8: 1317.186606418911,
                7: 1811.3770015615924, 6: 1376.115926239881, 5: 1540.7752938187357, 4: 1645.949869247225,
                3: 1840.1765572432564, 2: 2790.1972025210107, 1: 3226.5896769496094},
           13: {32: 1788.1588941618284, 31: 2053.2415478869266, 30: 2283.2082569926565, 29: 1560.905727323641,
                28: 1464.242548332954, 27: 1783.119157532436, 26: 1843.6772902476314, 25: 1455.5606343900474,
                24: 1405.086983697879, 23: 1198.5582987507646, 22: 1105.9485627472452, 21: 1347.519802971308,
                20: 700.8553623801103, 19: 665.3720804591579, 18: 672.6417420703698, 17: 610.9498933507949,
                16: 668.4497672976307, 15: 444.0730129173321, 14: 475.5959164025019, 12: 691.6593340683702,
                11: 250.58274698696297, 10: 1147.0908814363356, 9: 1168.662472459259, 8: 1315.406290460827,
                7: 1667.2002134095258, 6: 1255.5588588659502, 5: 1573.9876430005083, 4: 1840.7755295532288,
                3: 2030.067951046273, 2: 2792.291646976129, 1: 3463.6667568284206},
           12: {32: 2279.6794949417576, 31: 2557.591330587961, 30: 2789.6706695016246, 29: 1888.5411235248384,
                28: 1816.8580069955324, 27: 1974.8314372617094, 26: 1834.0858879944626, 25: 1639.329661091663,
                24: 1662.8700945204562, 23: 1548.2157352888248, 22: 1293.8434259067405, 21: 1307.9818749833291,
                20: 835.4008134871534, 19: 1128.6616534455904, 18: 1048.1260998705902, 17: 1210.996923854223,
                16: 564.3407026164648, 15: 670.0990016698115, 14: 1048.2519599327863, 13: 691.6593340683636,
                11: 862.5753462557535, 10: 467.6819528886715, 9: 508.8413858857078, 8: 981.0465711239015,
                7: 1093.2992781869928, 6: 765.5103949684365, 5: 1238.5433279050246, 4: 1701.4712901508717,
                3: 1862.1129048119942, 2: 2318.997302089413, 1: 3284.534228859902},
           11: {32: 1872.2675483539772, 31: 2124.5558054275602, 30: 2349.314735406246, 29: 1721.024245946348,
                28: 1618.6747779326897, 27: 1976.8771625625948, 26: 2074.1855572710806, 25: 1658.5065673335655,
                24: 1591.104552784647, 23: 1364.1337588223212, 22: 1318.985697709084, 21: 1587.9037233193105,
                20: 940.5730767955982, 19: 824.4060844875656, 18: 864.77301329695, 17: 689.4252803653394,
                16: 918.3167292575657, 15: 689.6873548847279, 14: 599.7021053499076, 13: 250.58274698696297,
                12: 862.5753462557535, 10: 1287.1101970272332, 9: 1363.0678011258663, 8: 1564.3148206864819,
                7: 1893.0088939462453, 6: 1491.1101932769384, 5: 1823.833367172943, 4: 2085.0567570543562,
                3: 2275.4361220195383, 2: 3037.4325445408917, 1: 3705.3792946229523},
           10: {32: 2720.0666922831433, 31: 2998.9853592506847, 30: 3229.9784144917176, 29: 2285.9244081601987,
                28: 2224.5650137664734, 27: 2316.8613870905483, 26: 2085.5518149367954, 25: 1993.3228195181573,
                24: 2043.8737727156426, 23: 1963.610660031852, 22: 1670.8681439991801, 21: 1585.6246798275317,
                20: 1241.790035337617, 19: 1583.236813819256, 18: 1491.3815868965921, 17: 1678.1010691120912,
                16: 948.9353276659574, 15: 1119.0844137730858, 14: 1514.9824560005632, 13: 1147.0908814363356,
                12: 467.6819528886715, 11: 1287.1101970272261, 9: 365.1703307445279, 8: 1118.6990732158804,
                7: 948.1605408477228, 6: 808.8383753319648, 5: 1330.6972953126565, 4: 1885.8276400038537,
                3: 2016.2114721549676, 2: 2196.871902987125, 1: 3372.1897626850637},
           9: {32: 2533.915350937685, 31: 2811.8462048906363, 30: 3038.727196904544, 29: 2045.938516370835,
               28: 1997.2830599795511, 27: 2028.7328387591085, 26: 1752.5702842600822, 25: 1719.3240229520472,
               24: 1791.8517597329085, 23: 1751.172234304343, 22: 1424.6764454133015, 21: 1273.2436567155328,
               20: 1046.8748549372026, 19: 1451.9518107044476, 18: 1337.8017732687633, 17: 1601.0851504530992,
               16: 758.2875667115228, 15: 998.6502122946195, 14: 1438.4080009742459, 13: 1168.662472459259,
               12: 508.8413858857078, 11: 1363.0678011258694, 10: 365.1703307445279, 8: 767.530675637227,
               7: 620.771650762201, 6: 447.8105733956572, 5: 967.8664865301524, 4: 1533.8997741871929,
               3: 1657.315526909025, 2: 1873.1355334339498, 1: 3007.1439077648884},
           8: {32: 2041.376175711676, 31: 2304.6820871397754, 30: 2514.966024981312, 29: 1463.5785665061499,
               28: 1446.880239289354, 27: 1343.8879130388914, 26: 995.718778931245, 25: 1080.5677410732005,
               24: 1199.6064952789477, 23: 1257.9664914676182, 22: 889.3256707414233, 21: 574.148647839936,
               20: 758.8310928992361, 19: 1203.1662748996193, 18: 1061.8581503224852, 17: 1446.7615146471917,
               16: 647.9009018610925, 15: 916.5682289798597, 14: 1317.186606418911, 13: 1315.406290460827,
               12: 981.0465711239015, 11: 1564.3148206864819, 10: 1118.6990732158804, 9: 767.5306756372328,
               7: 624.3088500545751, 6: 329.1448078538762, 5: 265.93970160039095, 4: 767.4099242364064,
               3: 902.0282245629927, 2: 1486.890462956956, 1: 2304.9794522984034},
           7: {32: 2663.228543574813, 31: 2928.1708300788046, 30: 3139.215490865927, 29: 2087.507487033359,
               28: 2070.9398729757913, 27: 1945.9503738265678, 26: 1531.0998053400472, 25: 1700.738482184805,
               24: 1823.6771295140293, 23: 1875.4143835574823, 22: 1508.4482642593791, 21: 1188.5627638069307,
               20: 1294.2657575770663, 19: 1747.8942360176768, 18: 1611.404634162588, 17: 1960.5480248241342,
               16: 1078.8419200293538, 15: 1367.3734962312833, 14: 1811.3770015615924, 13: 1667.2002134095285,
               12: 1093.2992781869928, 11: 1893.0088939462453, 10: 948.1605408477228, 9: 620.771650762201,
               8: 624.3088500545751, 6: 435.40381334462256, 5: 638.6805936340094, 4: 1229.9313008001895,
               3: 1290.1322500262702, 2: 1253.619532693833, 1: 2496.594919414793},
           6: {32: 2277.561010387585, 31: 2548.8121041006766, 30: 2766.973818585707, 29: 1731.5787539294984,
               28: 1701.169573116353, 27: 1651.9809737861408, 26: 1324.6735504339792, 25: 1368.006210632059,
               24: 1468.6001409809649, 23: 1484.1514514155244, 22: 1125.7276246078977, 21: 880.7472590292626,
               20: 863.7914090334656, 19: 1315.7672515899906, 18: 1180.9309556377584, 17: 1525.201226064552,
               16: 644.2857483913901, 15: 933.4270963049196, 14: 1376.115926239881, 13: 1255.5588588659539,
               12: 765.5103949684305, 11: 1491.1101932769384, 10: 808.8383753319648, 9: 447.8105733956572,
               8: 329.1448078538762, 7: 435.40381334462256, 5: 522.0981737651484, 4: 1089.0215110878596,
               3: 1209.5057028705921, 2: 1565.8264606402774, 1: 2573.051212323131},
           5: {32: 2124.600067710106, 31: 2375.2360514672664, 30: 2573.570003838408, 29: 1517.3247643774748,
               28: 1519.8223777569094, 27: 1326.2468298776148, 26: 892.4198935661087, 25: 1116.131961720565,
               24: 1260.1974484981351, 23: 1369.3025306204277, 22: 1006.3617976467431, 21: 608.3465824018605,
               20: 978.707934233689, 19: 1403.1852774846695, 18: 1262.415746622248, 17: 1659.2907540415563,
               16: 905.5594391165783, 15: 1162.9443424420301, 14: 1540.7752938187357, 13: 1573.9876430005083,
               12: 1238.5433279050246, 11: 1823.833367172943, 10: 1330.6972953126565, 9: 967.8664865301524,
               8: 265.93970160039095, 7: 638.6805936340094, 6: 522.0981737651572, 4: 600.9557566419345,
               3: 695.3369379545951, 2: 1249.4709223068423, 1: 2057.0454573742763},
           4: {32: 1805.672015178943, 31: 2019.1060281475955, 30: 2187.474163248299, 29: 1180.2467539981617,
               28: 1223.5622676375867, 27: 869.8190031779546, 26: 343.05821868731704, 25: 799.2083523194079,
               24: 971.3279456869814, 23: 1179.766362826474, 22: 902.1365066371866, 21: 505.880742418673,
               20: 1146.023445054975, 19: 1444.5427667212593, 18: 1323.7048924586343, 17: 1715.5521168633277,
               16: 1226.3395439801252, 15: 1396.7325485051026, 14: 1645.9498692472223, 13: 1840.7755295532288,
               12: 1701.4712901508717, 11: 2085.056757054358, 10: 1885.8276400038537, 9: 1533.8997741871956,
               8: 767.4099242364064, 7: 1229.9313008001895, 6: 1089.0215110878555, 5: 600.9557566419345,
               3: 194.24747862521454, 2: 1383.9284018354144, 1: 1625.3403255159906},
           3: {32: 1945.9794965730002, 31: 2145.829660354567, 30: 2302.2782618816605, 29: 1326.4401420513748,
               28: 1379.2640030711702, 27: 983.4442163258886, 26: 444.16707271467334, 25: 962.7578087084948,
               24: 1135.1092856159419, 23: 1356.5075584917502, 22: 1092.4017257506634, 21: 699.980672796228,
               20: 1337.7718181516755, 19: 1638.0115805011026, 18: 1517.8049336439049, 17: 1908.8377118209544,
               16: 1406.2803796662902, 15: 1586.303327215636, 14: 1840.1765572432564, 13: 2030.067951046273,
               12: 1862.1129048119967, 11: 2275.4361220195383, 10: 2016.2114721549676, 9: 1657.315526909025,
               8: 902.0282245629927, 7: 1290.1322500262702, 6: 1209.5057028705921, 5: 695.3369379545885,
               4: 194.24747862521454, 2: 1258.1810049415362, 1: 1441.6746842515258},
           2: {32: 3189.5267556541853, 31: 3400.2078666151942, 30: 3560.325892861812, 29: 2563.6069250619275,
               28: 2602.2338614754126, 27: 2240.64048916176, 26: 1700.7007911789503, 25: 2174.8025809548944,
               24: 2344.4293520446595, 23: 2523.7438267351436, 22: 2191.0800334637347, 21: 1756.1188750143995,
               20: 2228.174438789525, 19: 2645.804303751732, 18: 2506.3065813124617, 17: 2906.2342829396434,
               16: 2130.985343552939, 15: 2403.4243691571755, 14: 2790.1972025210093, 13: 2792.291646976129,
               12: 2318.997302089413, 11: 3037.43254454089, 10: 2196.871902987123, 9: 1873.1355334339478,
               8: 1486.890462956956, 7: 1253.619532693833, 6: 1565.8264606402774, 5: 1249.4709223068423,
               4: 1383.9284018354078, 3: 1258.1810049415433, 1: 1606.855737663741},
           1: {32: 2906.650951781033, 31: 2996.206963558929, 30: 3055.909393366116, 29: 2410.3925182311013,
               28: 2504.0584768172494, 27: 2003.7448879787976, 26: 1663.002214757609, 25: 2189.7689448820374,
               24: 2336.0943658146884, 23: 2601.089135005007, 22: 2444.02935458417, 21: 2117.5050356787933,
               20: 2764.8195044159866, 19: 3005.4760711021336, 18: 2902.7472791688883, 17: 3266.9981768288344,
               16: 2847.9362402850143, 15: 3019.7650974732874, 14: 3226.5896769496094, 13: 3463.666756828419,
               12: 3284.534228859902, 11: 3705.3792946229523, 10: 3372.1897626850637, 9: 3007.1439077648884,
               8: 2304.979452298401, 7: 2496.594919414793, 6: 2573.051212323131, 5: 2057.0454573742763,
               4: 1625.340325515996, 3: 1441.6746842515258, 2: 1606.855737663741}}

plt.rcParams['font.sans-serif'] = ['SimHei']


class GA:
    # x 参数个数 iterations 迭代次数
    def __init__(self, population_size, x, iterations, Mutates_rate, select_rate, lb, ub):
        self.population_size = population_size
        self.population = []
        self.x = x
        self.iterations = iterations
        self.Mutates_rate = Mutates_rate
        self.select_rate = select_rate
        self.decode_dic = {}
        self.lb = lb
        self.ub = ub
        self.count_Dight()

    # 计算编码长度
    def count_Dight(self):
        self.Dight = []
        for i in range(len(self.ub)):
            dight = math.ceil(math.log(self.ub[i], 2))
            self.Dight.append(dight)

    # 解码
    def Decode(self, Genes):
        res = 0
        for i in Genes:
            res = res * 2 + i
        return res

    # 编码

    def Coding(self, data, x):
        l = []
        while data != 0:
            l.append(data % 2)
            data //= 2
        for i in range(x - len(l)):
            l.append(0)
        return l[::-1]

    def count_suit(self, Individuals):
        L = []
        for Genes in Individuals:
            if self.decode_dic.get(tuple(Genes), -1) == -1:
                data = self.Decode(Genes)
                self.decode_dic[tuple(Genes)] = data
            else:
                data = self.decode_dic[tuple(Genes)]
            L.append(data)
        ori = 32
        res = 0
        for i in L:
            if ori != i:
                res += message[ori][i]
                ori = i
        res += message[ori][32]
        return res

    # 初始种群
    def init_population(self):
        index = [i for i in range(1, self.x + 1)]
        random.shuffle(index)
        progress = 1000
        for i in range(self.population_size):
            index = [i for i in range(1, self.x + 1)]
            random.shuffle(index)
            t = []
            for i in range(len(index)):
                t.append(self.Coding(index[i], self.Dight[i]))
            res = self.count_suit(t)
            for h in range(progress):
                new = []
                for i in t:
                    new.append(i.copy())
                while True:
                    x1 = numpy.random.randint(0, self.x)
                    x2 = numpy.random.randint(0, self.x)
                    if x1 != x2:
                        break
                p = new[x1]
                new[x1] = new[x2]
                new[x2] = p
                if self.count_suit(new) < res:
                    t = []
                    for j in new:
                        t.append(j.copy())
            self.population.append(t)

    # 种群适应度计算
    def Fitness(self):
        save = []
        the_sum = 0
        for Individuals in self.population:
            res = self.count_suit(Individuals)
            the_sum += res
            save.append([Individuals.copy(), res])
        self.population_size = len(save)
        return save, the_sum

    # 选择
    def Select(self):
        save, the_sum = self.Fitness()
        grad = [x[0] for x in sorted(save, key=lambda x: x[1])]
        length = 300
        new_population = grad[:length]
        f = math.floor(math.log(self.population_size, 2))
        for i in grad[length:]:
            if random.random() < self.select_rate and f > 0:
                new_population.append(i)
                f -= 1
        self.population = new_population
        self.population_size = len(new_population)

    # 交叉
    def Crisscross(self):
        for i in range(self.population_size):
            while True:
                x1 = numpy.random.randint(0, self.population_size)
                x2 = numpy.random.randint(0, self.population_size)
                if x1 != x2:
                    break
            left = numpy.random.randint(0, int(self.x / 2) + 1)
            right = numpy.random.randint(left + 1, self.x)
            new_child1 = []
            new_child2 = []
            parents1 = []
            parents2 = []
            for j in self.population[x1][left:right + 1]:
                parents1.append(j.copy())
            for j in self.population[x2][left:right + 1]:
                parents2.append(j.copy())
            dot = random.randint(0, self.x - len(parents1))
            jud1 = 0
            for j in self.population[x1]:
                if j not in parents2:
                    new_child1.append(j.copy())
            for j in self.population[x2]:
                if j not in parents1:
                    new_child2.append(j.copy())
            new_child1 = new_child1[0:dot] + parents2 + new_child1[dot:]
            new_child2 = new_child2[0:dot] + parents1 + new_child2[dot:]
            # print('len',len(new_child1))
            self.population.append(new_child1)
            self.population.append(new_child2)
        self.population_size = len(self.population)

    # 变异
    def Mutates(self):
        for i in range(self.population_size):
            if random.random() < self.Mutates_rate:
                x = numpy.random.randint(0, self.population_size)
                while True:
                    dot1 = numpy.random.randint(0, self.x)
                    dot2 = numpy.random.randint(0, self.x)
                    if dot1 != dot2:
                        break
                new = []
                for j in self.population[x]:
                    new.append(j.copy())
                t = new[dot1]
                new[dot1] = new[dot2]
                new[dot2] = t
                self.population.append(new)
        self.population_size = len(self.population)

    def run_it(self):
        self.init_population()
        print(self.population)
        for i in range(self.iterations):
            self.Select()
            self.Crisscross()
            self.Mutates()
            if i % 10 == 0:
                print(self.population_size)
                print("finish", i + 1)
        self.the_res = 100000
        self.way = "##"
        t = self.Fitness()
        print(len(t[0]))
        for i in range(len(t[0])):
            if i % 10 == 0:
                print(t[0][i][1])
            if self.the_res > t[0][i][1]:
                self.the_res = t[0][i][1]
                self.way = t[0][i][0]
        res_dic = {}
        for i in self.way:
            data = self.Decode(i)
            if res_dic.get(data, -1) == -1:
                res_dic[data] = 1
            else:
                res_dic[data] += 1
        print(res_dic)


ga = GA(100, 31, 1000, 0.3, 0.5, numpy.ones(31), 31 * numpy.ones(31))
ga.run_it()
print('最短距离', ga.the_res)
print('路径', ga.way)

plot_x = [dic_index_place[32][0]]
plot_y = [dic_index_place[32][1]]

for i in ga.way:
    data = ga.Decode(i)
    plot_x.append(dic_index_place[data][0])
    plot_y.append(dic_index_place[data][1])
plot_x.append(dic_index_place[32][0])
plot_y.append(dic_index_place[32][1])

now = time.time()
print("用时为:", (now - past) / 60)

plt.axis([1.5, 2.3, 0.3, 0.85])

for i in range(1, 34):
    plt.plot(plot_x[0:i], plot_y[0:i], 'b-o')
    plt.pause(0.2)
print(len(ga.way))
plt.annotate(dic_index_name[32], xy=(dic_index_place[32][0] - 0.01, dic_index_place[32][1] + 0.015))
for i in ga.way:
    data = ga.Decode(i)
    plt.annotate(dic_index_name[data], xy=(dic_index_place[data][0] - 0.01, dic_index_place[data][1] + 0.015))
plt.show()
